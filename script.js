const questions = [

  {
    "question": "কোন সুলতান দিল্লিতে 'কুতুব মিনার' নির্মাণ সম্পন্ন করেন?",
    "options": ["কুতুবউদ্দিন আইবক", "ইলতুৎমিশ", "রাজিয়া সুলতানা", "আলাউদ্দিন খিলজি"],
    "answer": "ইলতুৎমিশ",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ভারতীয় সংবিধানের কোন সংশোধনীতে 'সমাজতান্ত্রিক' এবং 'ধর্মনিরপেক্ষ' শব্দগুলি যুক্ত করা হয়?",
    "options": ["42তম", "44তম", "73তম", "74তম"],
    "answer": "42তম",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন মুঘল সম্রাট 'আইন-ই-আকবরী' গ্রন্থটি রচনা করেন?",
    "options": ["আবুল ফজল", "টোডরমল", "ফৈজি", "আকবর"],
    "answer": "আবুল ফজল",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "লর্ড রিপনের আমলে প্রথম ফ্যাক্টরি আইন (1881) এর প্রধান উদ্দেশ্য কী ছিল?",
    "options": ["ব্রিটিশ শ্রমিকদের অধিকার রক্ষা", "ভারতীয় শ্রমিকদের কাজের সময় সীমিত করা", "মালিকদের সুবিধা বৃদ্ধি", "বেকারত্ব কমানো"],
    "answer": "ভারতীয় শ্রমিকদের কাজের সময় সীমিত করা",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "গৌতম বুদ্ধের প্রথম ধর্মোপদেশ কোথায় অনুষ্ঠিত হয়েছিল?",
    "options": ["বোধগয়া", "সারনাথ", "লুম্বিনি", "কুশিনগর"],
    "answer": "সারনাথ",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন গ্যাসকে 'মার্শ গ্যাস' বলা হয়?",
    "options": ["প্রোপেন", "ইথেন", "মিথেন", "বিউটেন"],
    "answer": "মিথেন",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন বিজ্ঞানী 'পেনিসিলিন' আবিষ্কার করেন?",
    "options": ["লুই পাস্তুর", "আলেকজান্ডার ফ্লেমিং", "রবার্ট কোচ", "চার্লস ডারউইন"],
    "answer": "আলেকজান্ডার ফ্লেমিং",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন সালে বঙ্গভঙ্গ রদ হয়েছিল?",
    "options": ["1905", "1909", "1911", "1919"],
    "answer": "1911",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কর্কটক্রান্তি রেখা ভারতের কয়টি রাজ্যের ওপর দিয়ে গেছে?",
    "options": ["5", "6", "7", "8"],
    "answer": "8",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "বিজয়ওয়াড়া শহরটি কোন নদীর তীরে অবস্থিত?",
    "options": ["মহানদী", "গোদাবরী", "কৃষ্ণা", "কাবেরী"],
    "answer": "কৃষ্ণা",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন শাসক 'বিক্রমাদিত্য' উপাধি গ্রহণ করেন?",
    "options": ["সমুদ্রগুপ্ত", "চন্দ্রগুপ্ত প্রথম", "চন্দ্রগুপ্ত দ্বিতীয়", "কুমারগুপ্ত"],
    "answer": "চন্দ্রগুপ্ত দ্বিতীয়",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন বছর কলকাতায় ইন্ডিয়ান অ্যাসোসিয়েশন ফর দ্য কাল্টিভেশন অফ সায়েন্স (IACS) প্রতিষ্ঠিত হয়?",
    "options": ["1876", "1890", "1900", "1911"],
    "answer": "1876",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন অ্যাসিডকে 'ভিট্রিওলের তেল' বলা হয়?",
    "options": ["নাইট্রিক অ্যাসিড", "সালফিউরিক অ্যাসিড", "হাইড্রোchloric অ্যাসিড", "অ্যাসিটিক অ্যাসিড"],
    "answer": "সালফিউরিক অ্যাসিড",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ভারতীয় সংবিধানের প্রস্তাবনা কতবার সংশোধিত হয়েছে?",
    "options": ["একবার", "দুইবার", "তিনবার", "কখনো নয়"],
    "answer": "একবার",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ভারতের প্রথম প্রধান বিচারপতি কে ছিলেন?",
    "options": ["এম. পতঞ্জলি শাস্ত্রী", "হরিলাল জে. কানিয়া", "সুধী রঞ্জন দাস", "এ.কে. সরকার"],
    "answer": "হরিলাল জে. কানিয়া",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ইন্ডিয়ান ন্যাশনাল কংগ্রেসের প্রথম সভাপতি কে ছিলেন?",
    "options": ["অ্যালান অক্টাভিয়ান হিউম", "ডব্লিউ.সি. ব্যানার্জি", "দাদাভাই নওরোজি", "ফিরোজ শাহ মেহতা"],
    "answer": "ডব্লিউ.সি. ব্যানার্জি",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "'স্বদেশ বান্ধব সমিতি' কে প্রতিষ্ঠা করেন?",
    "options": ["সুরেন্দ্রনাথ বন্দ্যোপাধ্যায়", "অশ্বিনী কুমার দত্ত", "বারীন্দ্র কুমার ঘোষ", "পুলিন বিহারী দাস"],
    "answer": "অশ্বিনী কুমার দত্ত",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন দেশকে 'হাজার হ্রদের দেশ' বলা হয়?",
    "options": ["সুইডেন", "ফিনল্যান্ড", "নরওয়ে", "কানাডা"],
    "answer": "ফিনল্যান্ড",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "'ইন্ডিয়ান রিপাবলিকান আর্মি' কে প্রতিষ্ঠা করেন?",
    "options": ["সর্দার বল্লভভাই প্যাটেল", "সুভাষ চন্দ্র বসু", "ভগত সিং", "সূর্য সেন"],
    "answer": "সূর্য সেন",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কম্পিউটারের কোন অংশকে তার 'মস্তিষ্ক' বলা হয়?",
    "options": ["র‍্যাম (RAM)", "সেন্ট্রাল প্রসেসিং ইউনিট (CPU)", "হার্ড ডিস্ক ড্রাইভ (HDD)", "মাদারবোর্ড"],
    "answer": "সেন্ট্রাল প্রসেসিং ইউনিট (CPU)",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ভারতের কোন রাজ্যে 'শবরীমালা মন্দির' অবস্থিত?",
    "options": ["তামিলনাড়ু", "কর্ণাটক", "কেরালা", "অন্ধ্র প্রদেশ"],
    "answer": "কেরালা",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "সতীদাহ প্রথা কে বিলুপ্ত করেন?",
    "options": ["লর্ড ডালহৌসি", "লর্ড উইলিয়াম বেন্টিঙ্ক", "লর্ড ক্যানিং", "লর্ড রিপন"],
    "answer": "লর্ড উইলিয়াম বেন্টিঙ্ক",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "কোন ভিটামিনের অভাবে রক্তক্ষরণ হয়?",
    "options": ["ভিটামিন এ", "ভিটামিন বি", "ভিটামিন সি", "ভিটামিন কে"],
    "answer": "ভিটামিন কে",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "পশ্চিমবঙ্গের জাতীয় ফুল কোনটি?",
    "options": ["পদ্ম", "শাপলা", "শিউলি", "জুঁই"],
    "answer": "শিউলি",
    "userAnswer": null,
    "status": null
  },
  {
    "question": "ভারতের প্রথম পারমাণবিক বিদ্যুৎ কেন্দ্র কোনটি?",
    "options": ["তারাপুর", "কালপাক্কাম", "নারোরা", "কাকরাপাড়"],
    "answer": "তারাপুর",
    "userAnswer": null,
    "status": null
  }

];

let currentQuestionIndex = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let skippedCount = 0;
let selectedOption = null;
let questionTimerInterval;
const questionTimeLimit = 30;
let questionTimeLeft;
let userName = ''; // ব্যবহারকারীর নাম সংরক্ষণের জন্য ভেরিয়েবল
const passMarkPercentage = 60; // Changed to 60%

// DOM Elements
const nameInputScreen = document.getElementById('nameInputScreen');
const userNameInput = document.getElementById('userNameInput');
const proceedToStartScreenButton = document.getElementById('proceedToStartScreenButton');
const nameInputMessage = document.getElementById('nameInputMessage');

const startScreen = document.getElementById('startScreen');
const startButton = document.getElementById('startButton');

const totalQuestionsInfo = document.getElementById('totalQuestionsInfo');
const fullMarksInfo = document.getElementById('fullMarksInfo');
const timeLimitInfo = document.getElementById('timeLimitInfo');

const quizScreen = document.getElementById('quizScreen');

const scoreDisplayElem = document.getElementById('scoreDisplay');
const questionIndexDisplayElem = document.getElementById('questionIndexDisplay');

const questionTextBox = document.getElementById('questionTextBox');
const optionsContainer = document.getElementById('optionsContainer');
const feedbackMessage = document.getElementById('feedbackMessage');
const nextButton = document.getElementById('nextButton');
const skipButton = document.getElementById('skipButton');
const submitButton = document.getElementById('submitButton');

const questionTimerTextElem = document.getElementById('questionTimer');
const progressRingBar = document.querySelector('.progress-ring-bar');
const circumference = 2 * Math.PI * 35;
progressRingBar.style.strokeDasharray = circumference;
progressRingBar.style.strokeDashoffset = circumference;


// Set initial info on start screen
totalQuestionsInfo.textContent = questions.length;
fullMarksInfo.textContent = questions.length;
timeLimitInfo.textContent = Math.ceil(questions.length * questionTimeLimit / 60);

// --- Event Listeners ---
proceedToStartScreenButton.addEventListener('click', handleNameInputAndShowStartScreen);
startButton.addEventListener('click', startQuiz);

// Disable manual interaction with buttons
nextButton.style.display = 'none';
skipButton.style.display = 'none';
submitButton.style.display = 'none';


// Function to shuffle an array (Fisher-Yates algorithm)
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// --- Name Input and Screen Flow ---
function handleNameInputAndShowStartScreen() {
  const inputName = userNameInput.value.trim();
  if (inputName === '') {
    nameInputMessage.textContent = "আপনার নাম লিখুন কুইজ শুরু করার জন্য।";
    return;
  }
  userName = inputName; // ব্যবহারকারীর নাম সংরক্ষণ করুন
  nameInputMessage.textContent = ''; // মেসেজ মুছে ফেলুন
  nameInputScreen.classList.remove('active');
  startScreen.classList.add('active'); // নাম ইনপুট করার পর startScreen দেখান
}

function startQuiz() {
  // startScreen থেকে কুইজ শুরু করার ফাংশন
  // Shuffle questions at the start of the quiz
  shuffleArray(questions); // Add this line to shuffle questions
  questions.forEach(q => shuffleArray(q.options)); // Shuffle options for each question
  startScreen.classList.remove('active');
  quizScreen.classList.add('active');
  resetQuizState(); // কুইজ স্টেট রিসেট করুন কুইজ শুরু করার আগে
  loadQuestion();
  scoreDisplayElem.textContent = score;
}

function resetQuizState() {
  currentQuestionIndex = 0;
  score = 0;
  correctCount = 0;
  wrongCount = 0;
  skippedCount = 0;
  // Reset user answers and status for each question
  questions.forEach(q => {
    q.userAnswer = null;
    q.status = null;
  });
  clearInterval(questionTimerInterval); // নিশ্চিত করুন কোনো টাইমার চলছে না
}

function updateQuestionTimerDisplay() {
  questionTimerTextElem.textContent = questionTimeLeft;
  const circumference = 2 * Math.PI * 35;
  const offset = circumference - (questionTimeLeft / questionTimeLimit) * circumference;
  progressRingBar.style.strokeDashoffset = offset;
  // Change color based on time left
  if (questionTimeLeft <= 10) {
    progressRingBar.style.stroke = '#FF6347';
  } else if (questionTimeLeft <= 20) {
    progressRingBar.style.stroke = '#FFD700';
  } else {
    progressRingBar.style.stroke = '#28a745';
  }
}

function startQuestionTimer() {
  clearInterval(questionTimerInterval);
  questionTimeLeft = questionTimeLimit;
  updateQuestionTimerDisplay();
  questionTimerInterval = setInterval(() => {
    questionTimeLeft--;
    updateQuestionTimerDisplay();
    if (questionTimeLeft <= 0) {
      clearInterval(questionTimerInterval);
      // Only proceed if the question hasn't been answered yet
      if (questions[currentQuestionIndex].status === null) {
        // Check status
        handleTimeUp();
      }
    }
  }, 1000);
}

// Function to handle Text-to-Speech
function speak(text, onEndCallback) {
  if ('speechSynthesis' in window) {
    const speech = new SpeechSynthesisUtterance();
    speech.lang = 'bn-IN';
    speech.text = text;
    // Set up the onend callback
    if (onEndCallback) {
      speech.onend = onEndCallback;
    }
    window.speechSynthesis.speak(speech);
  } else {
    console.log("Speech Synthesis not supported");
    // If speech is not supported, just call the callback
    if (onEndCallback) {
      onEndCallback();
    }
  }
}


function loadQuestion() {
    if (currentQuestionIndex >= questions.length) {
        // কুইজ শেষ হয়েছে, এখন ফলাফলের স্ক্রিন দেখানোর পরিবর্তে পেজ রিলোড করুন
        location.reload();
        return;
    }

  const currentQuestion = questions[currentQuestionIndex];
  questionIndexDisplayElem.textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
  questionTextBox.textContent = currentQuestion.question;
  optionsContainer.innerHTML = '';
  feedbackMessage.textContent = '';
  selectedOption = null;
  nextButton.style.display = 'none';
  skipButton.style.display = 'inline-block';
  submitButton.style.display = 'none';
  
  // Create option buttons and append to container
  currentQuestion.options.forEach(option => {
    const optionButton = document.createElement('button');
    optionButton.classList.add('option');
    optionButton.textContent = option;
    optionButton.addEventListener('click', () => handleOptionClick(optionButton, option));
    optionsContainer.appendChild(optionButton);
  });
  startQuestionTimer();
}

function handleOptionClick(clickedButton, selectedAnswer) {
    // Disable all option buttons
    const allOptions = optionsContainer.querySelectorAll('.option');
    allOptions.forEach(option => option.disabled = true);
    
    // Check if the selected answer is correct
    const currentQuestion = questions[currentQuestionIndex];
    const correctAnswer = currentQuestion.answer;
    
    selectedOption = selectedAnswer; // Save the user's answer
    
    if (selectedAnswer === correctAnswer) {
        clickedButton.classList.add('correct');
        feedbackMessage.textContent = 'সঠিক উত্তর!';
        speak('সঠিক উত্তর');
        questions[currentQuestionIndex].userAnswer = selectedAnswer; // Save user's answer
        questions[currentQuestionIndex].status = 'correct'; // Mark as correct
        score++;
        correctCount++;
    } else {
        clickedButton.classList.add('wrong');
        feedbackMessage.textContent = 'ভুল উত্তর।';
        speak('ভুল উত্তর');
        questions[currentQuestionIndex].userAnswer = selectedAnswer; // Save user's answer
        questions[currentQuestionIndex].status = 'wrong'; // Mark as wrong
        wrongCount++;
        // Find and highlight the correct answer
        allOptions.forEach(option => {
            if (option.textContent === correctAnswer) {
                option.classList.add('correct');
            }
        });
    }

    scoreDisplayElem.textContent = score;
    clearInterval(questionTimerInterval);
    nextButton.style.display = 'inline-block';
    skipButton.style.display = 'none';
    
    // If it's the last question, show the submit button
    if (currentQuestionIndex === questions.length - 1) {
        nextButton.style.display = 'none';
        submitButton.style.display = 'inline-block';
    }
}

function handleTimeUp() {
    // If time is up, it's considered skipped
    questions[currentQuestionIndex].userAnswer = null; // No answer
    questions[currentQuestionIndex].status = 'skipped'; // Mark as skipped
    skippedCount++;
    
    // Find and highlight the correct answer
    const allOptions = optionsContainer.querySelectorAll('.option');
    allOptions.forEach(option => {
        if (option.textContent === questions[currentQuestionIndex].answer) {
            option.classList.add('correct');
        }
        option.disabled = true; // Disable all options
    });
    
    feedbackMessage.textContent = 'সময় শেষ! এটি বাদ দেওয়া হয়েছে।';
    speak('সময় শেষ');
    
    nextButton.style.display = 'inline-block';
    skipButton.style.display = 'none';
    
    if (currentQuestionIndex === questions.length - 1) {
        nextButton.style.display = 'none';
        submitButton.style.display = 'inline-block';
    }
}

nextButton.addEventListener('click', () => {
    currentQuestionIndex++;
    loadQuestion();
});

skipButton.addEventListener('click', () => {
    handleTimeUp();
});

submitButton.addEventListener('click', () => {
    if (currentQuestionIndex === questions.length - 1) {
        // কুইজ শেষ, ফলাফলের স্ক্রিন দেখানোর পরিবর্তে পেজ রিলোড করুন
        location.reload();
    }
});

// Initial call to set up info
document.addEventListener('DOMContentLoaded', () => {
    totalQuestionsInfo.textContent = questions.length;
    fullMarksInfo.textContent = questions.length;
    timeLimitInfo.textContent = Math.ceil(questions.length * questionTimeLimit / 60);
});